var f=Object.defineProperty;var L=(t,e,s)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var l=(t,e,s)=>(L(t,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const c={htmlToHTMLCollection(t){const e=document.createElement("template");return e.innerHTML=t,e.content.children},htmlToElement(t){const e=document.createElement("template");return e.innerHTML=t,e.content.firstChild},needMobileLayout(){let t=!1;if("maxTouchPoints"in navigator)t=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)t=navigator.msMaxTouchPoints>0;else{const e=matchMedia==null?void 0:matchMedia("(pointer:coarse)");if((e==null?void 0:e.media)==="(pointer:coarse)")t=!!e.matches;else if("orientation"in window)t=!0;else{const s=navigator.userAgent;t=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(s)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(s)}}return t&&window.innerWidth<600}},y=`<div id="claimContainer" class="claim-container hidden">\r
    <p id="claim-content"></p>\r
    <button id="btnClaimStartGame" class="app-button">Start Game</button>\r
</div>\r
\r
<div id="game-container" class="hidden">\r
    <section class="header-section">\r
        <div>\r
            <button id="btnStartGame" class="app-button">Start Game</button>\r
        </div>\r
        <app-score></app-score>\r
    </section>\r
    <div class="game-content">\r
        <app-grid></app-grid>\r
        <app-virtual-pad></app-virtual-pad>\r
    </div>\r
</div>\r
<app-gameover></app-gameover>\r
<app-gamewin></app-gamewin>\r
<app-gamewinbirth></app-gamewinbirth>\r
<audio id="pacman_beginning" src="/pacman_beginning.wav" class="hidden"></audio>\r
<audio id="pacman_chomp" src="/pacman_chomp.wav" class="hidden"></audio>\r
<audio id="pacman_death" src="/pacman_death.wav" class="hidden"></audio>\r
<audio id="pacman_eatfruit" src="/pacman_eatfruit.wav" class="hidden"></audio>\r
<audio id="pacman_eatghost" src="/pacman_eatghost.wav" class="hidden"></audio>\r
<audio id="pacman_win" src="/pacman_win.mp3" class="hidden"></audio>`;const b=`<section class="grid-container">\r
    <div class="grid"></div>\r
</section>`,v={DESKTOP:{BOARD_WIDTH:28,BOARD_HEIGHT:25,GHOSTS_START:[348,376,351,379],LAYOUT:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,3,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,3,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,0,0,0,3,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,4,4,4,4,4,4,4,4,4,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,1,1,1,2,2,1,1,1,4,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,1,2,2,2,2,2,2,1,4,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,4,1,2,2,2,2,2,2,1,4,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,1,2,2,2,2,2,2,1,4,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,1,1,1,1,1,1,1,1,4,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,4,1,1,1,1,1,1,1,1,4,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,3,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,3,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},MOBILE:{BOARD_WIDTH:22,BOARD_HEIGHT:27,GHOSTS_START:[296,298,294,317],LAYOUT:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,3,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,0,0,0,3,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,4,4,4,4,4,4,4,4,4,4,1,1,1,1,0,1,1,0,1,1,1,1,4,1,1,1,2,2,1,1,1,4,1,1,1,1,0,1,1,0,1,1,1,1,4,1,2,2,2,2,2,2,1,4,1,1,1,1,0,1,1,0,0,0,0,0,4,1,2,2,2,2,2,2,1,4,0,0,0,0,0,1,1,0,1,1,1,1,4,1,2,2,2,2,2,2,1,4,1,1,1,1,0,1,1,0,1,1,1,1,4,1,1,1,1,1,1,1,1,4,1,1,1,1,0,1,1,0,1,1,1,1,4,1,1,1,1,1,1,1,1,4,1,1,1,1,0,1,1,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,3,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}};class m{constructor(e,s,r){this.className=e,this.startIndex=s,this.speed=r,this.currentIndex=s,this.timerId=NaN,this.isScared=!1}}const T=10,I=100,A=1,S=5e3,i=c.needMobileLayout()?v.MOBILE:v.DESKTOP,D=["left","right","up","down"];customElements.define("app-grid",class extends HTMLElement{constructor(){super();l(this,"squares",[]);l(this,"pacmanPosition",-1);l(this,"score",0);l(this,"directions",[1,-1,i.BOARD_WIDTH,-i.BOARD_WIDTH]);l(this,"powerPelletCells",[])}connectedCallback(){const e=c.htmlToElement(b);this.appendChild(e),this.addEvents()}resetGame(){this.squares=[],this.score=0,this.powerPelletCells=[],this.pacmanPosition=490}createBoard(){const e=this.querySelector(".grid");e.innerHTML="";const s=document.createDocumentFragment();for(let r=0,a=i.LAYOUT.length;r<a;r++){const n=document.createElement("div"),o=i.LAYOUT[r];if(n.classList.add("cell"),o===0){n.classList.add("dot");const d=document.createElement("div");d.classList.add("pac-dot"),n.append(d)}else o===1?n.classList.add("wall"):o===2?n.classList.add("ghost-lair"):o===3&&(n.classList.add("power-pellet"),this.powerPelletCells.push(r));(o===0||o===2||o===3||o===4)&&n.classList.add("cell-border",...this.getWallBorder(i,r)),s.appendChild(n),this.squares.push(n)}e.appendChild(s)}addEvents(){document.addEventListener("keyup",this.onkeyUp.bind(this)),document.addEventListener("startgame",this.startGame.bind(this))}onkeyUp(e){if(this.pacmanPosition<0||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.code))return!1;switch(this.squares[this.pacmanPosition].classList.remove("characters","pacman",[...D]),e.code){case"ArrowUp":this.moveUp();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft();break;case"ArrowRight":this.moveRight();break}this.squares[this.pacmanPosition].classList.add("characters","pacman",e.code.replace("Arrow","").toLowerCase()),this.pacDotEaten(),this.powerPelletEaten(),this.pacGhostEaten(),this.pacGameOver()}startGame(){document.getElementById("pacman_beginning").play(),this.resetGame(),this.createBoard(),this.squares[this.pacmanPosition].innerHTML="",this.squares[this.pacmanPosition].classList.add("characters","pacman","left"),this.setupGhosts()}moveLeft(){this.pacmanPosition%i.BOARD_WIDTH>0&&this.canMove(this.pacmanPosition-1)&&(this.pacmanPosition-=1)}moveRight(){this.pacmanPosition%i.BOARD_WIDTH!==i.BOARD_WIDTH-1&&this.canMove(this.pacmanPosition+1)&&(this.pacmanPosition+=1)}moveUp(){this.pacmanPosition-i.BOARD_WIDTH>=0&&this.canMove(this.pacmanPosition-i.BOARD_WIDTH)&&(this.pacmanPosition-=i.BOARD_WIDTH)}moveDown(){this.pacmanPosition+i.BOARD_WIDTH<i.LAYOUT.length&&this.canMove(this.pacmanPosition+i.BOARD_WIDTH)&&(this.pacmanPosition+=i.BOARD_WIDTH)}canMove(e){const s=this.squares[e].classList;return!s.contains("ghost-lier")&&!s.contains("wall")}pacDotEaten(){this.squares[this.pacmanPosition].classList.contains("dot")&&(this.squares[this.pacmanPosition].innerHTML="",this.score+=A,this.updateScore(),this.squares[this.pacmanPosition].classList.remove("dot"),document.getElementById("pacman_chomp").play())}pacGhostEaten(){this.ghosts.forEach(e=>{if(e.isScared&&this.squares[e.currentIndex].classList.contains("pacman")){debugger;this.squares[e.currentIndex].classList.remove("ghost",e.className,"scared-ghost"),e.currentIndex=e.startIndex,this.squares[e.currentIndex].classList.add("ghost","characters",e.className),this.score+=I,document.getElementById("pacman_eatghost").play()}})}pacGameOver(){const e=this.squares[this.pacmanPosition].classList;e.contains("pacman")&&e.contains("ghost")&&this.ghosts.some(r=>r.currentIndex===this.pacmanPosition)&&this.raiseGameOver()}stopEvents(){this.ghosts.forEach(e=>clearInterval(e.timerId)),document.removeEventListener("keyup",this.onkeyUp)}raiseGameOver(){this.stopEvents(),document.dispatchEvent(new CustomEvent("gameover",{detail:this.score}))}raiseWin(){this.stopEvents(),document.dispatchEvent(new CustomEvent("gamewin",{detail:this.score}))}powerPelletEaten(){this.squares[this.pacmanPosition].classList.contains("power-pellet")&&(this.score+=T,this.ghosts.forEach(e=>{e.isScared=!0,this.squares[e.currentIndex].classList.add("ghost-scared"),setTimeout(()=>{e.isScared=!1,this.squares[e.currentIndex].classList.remove("ghost-scared")},S)}),this.squares[this.pacmanPosition].classList.remove("power-pellet"),this.powerPelletCells=this.powerPelletCells.filter(e=>e!==this.pacmanPosition),document.getElementById("pacman_eatfruit").play(),this.checkForWin())}checkForWin(){this.powerPelletCells.length===0&&this.raiseWin()}getWallBorder(e,s){const a=e.BOARD_WIDTH,n=e.LAYOUT,o=s-a>0?s-a:null,d=s%a!==a-1?s+1:null,h=s%a>0?s-1:null,u=s+a<n.length?s+a:null,g={top:o&&n[o]===1,right:d&&n[d]===1,left:h&&n[h]===1,bottom:u&&n[u]===1};return Object.entries(g).reduce((p,[E,w])=>(w&&p.push(E+"-border"),p),[])}updateScore(){const e=new CustomEvent("updatescore",{detail:this.score});document.dispatchEvent(e)}setupGhosts(){this.createGhosts(),this.startGhosts()}createGhosts(){const e=i.GHOSTS_START;this.ghosts=[new m("blinky",e[0],250),new m("pinky",e[1],400),new m("inky",e[2],300),new m("clyde",e[3],500)],this.ghosts.forEach(s=>this.squares[s.currentIndex].classList.add("ghost","characters",s.className))}startGhosts(){this.ghosts.forEach(e=>this.moveGhost(e))}moveGhost(e){let s=this.directions[Math.floor(Math.random()*this.directions.length)];e.timerId=setInterval(()=>{this.canGhostMove(e.currentIndex+s)?(this.squares[e.currentIndex].classList.remove("ghost","characters",e.className,"scared-ghost"),e.currentIndex=e.currentIndex+s,this.squares[e.currentIndex].classList.add("ghost","characters",e.className),e.isScared&&this.squares[e.currentIndex].classList.add("characters","scared-ghost")):s=this.directions[Math.floor(Math.random()*this.directions.length)],window.requestAnimationFrame(()=>{this.squares[e.currentIndex].classList.contains("pacman")&&this.raiseGameOver()})},e.speed)}canGhostMove(e){const s=this.squares[e].classList;return!s.contains("wall")&&!s.contains("ghost")}});const G=`<div class="score-container">\r
    <span class="score-label">Score:</span><span id="score">-</span>\r
</div>`;customElements.define("app-score",class extends HTMLElement{constructor(){super()}connectedCallback(){const t=c.htmlToElement(G);this.appendChild(t),this.scoreNode=this.querySelector("#score"),document.addEventListener("updatescore",e=>{this.scoreNode.innerHTML=e.detail})}});const B=`<div class="virtual-pad">\r
    <button class="app-button" id="virtualBtnLeft">\r
        <i class="pad-arrow left"></i>\r
    </button>\r
    <button class="app-button" id="virtualBtnUp">\r
        <i class="pad-arrow up"></i>\r
    </button>\r
    <button class="app-button" id="virtualBtnDown">\r
        <i class="pad-arrow down"></i>\r
    </button>\r
    <button class="app-button" id="virtualBtnRight">\r
        <i class="pad-arrow right"></i>\r
    </button>\r
</div>`;customElements.define("app-virtual-pad",class extends HTMLElement{constructor(){super()}connectedCallback(){if(c.needMobileLayout()){const t=c.htmlToElement(B);this.appendChild(t),this.addEvents()}}addEvents(){document.getElementById("virtualBtnLeft").addEventListener("click",()=>this.raiseKeyUp("ArrowLeft")),document.getElementById("virtualBtnRight").addEventListener("click",()=>this.raiseKeyUp("ArrowRight")),document.getElementById("virtualBtnUp").addEventListener("click",()=>this.raiseKeyUp("ArrowUp")),document.getElementById("virtualBtnDown").addEventListener("click",()=>this.raiseKeyUp("ArrowDown"))}raiseKeyUp(t){const e=new KeyboardEvent("keyup",{code:t});document.dispatchEvent(e)}});const O=`<dialog id="gameOverDialog" class="game-over">\r
    <div class="dialog-content">\r
        <img src="/game_over.png" />\r
        <h1>Game Over!</h1>\r
        <p>It seems you can't unlock your phone and escape from this arcade world until your avatar eats all the dots\r
        </p>\r
        <button id="btnRestartGame" class="app-button">START GAME AGAIN</button>\r
    </div>\r
</dialog>`;customElements.define("app-gameover",class extends HTMLElement{constructor(){super()}connectedCallback(){const t=c.htmlToElement(O);this.appendChild(t),this.querySelector("#btnRestartGame").addEventListener("click",()=>{document.querySelector("#game-container").classList.remove("hidden"),document.getElementById("gameOverDialog").close(),document.dispatchEvent(new CustomEvent("startgame"))})}show(t){document.querySelector("#game-container").classList.add("hidden"),document.getElementById("gameOverDialog").showModal()}});const P=`<dialog id="gameWinDialog" class="game-win">\r
    <div class="dialog-content">\r
        <img src="/game_win.png" />\r
        <h1>YOU WIN</h1>\r
        <p>Now you can go back to your real world, but don't leave your avatar alone too much... and come back soon to\r
            play!</p>\r
        <button id="btnRestartGame" class="app-button">START GAME AGAIN</button>\r
    </div>\r
</dialog>`;customElements.define("app-gamewin",class extends HTMLElement{constructor(){super()}connectedCallback(){const t=c.htmlToElement(P);this.appendChild(t),this.querySelector("#btnRestartGame").addEventListener("click",()=>{document.querySelector("#game-container").classList.remove("hidden"),document.getElementById("gameWinDialog").close(),document.dispatchEvent(new CustomEvent("startgame"))})}show(t){document.querySelector("#game-container").classList.add("hidden"),document.getElementById("gameWinDialog").showModal()}});const C=`<dialog id="gameWinBirthDialog" class="game-win">\r
    <div class="dialog-content">\r
        <h1>YOU WIN</h1>\r
        <p>(but you still have to start the video manually ... )</p>\r
        <iframe id="videoFrame" width="100%" height="300px" src="https://www.youtube.com/embed/FvIbCKutYNc"\r
            title="Three Tibbs - Happy Birthday - Punk version" frameborder="0"\r
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\r
            allowfullscreen></iframe>\r
        <button id="btnRestartGame" class="app-button">START GAME AGAIN</button>\r
    </div>\r
</dialog>`;customElements.define("app-gamewinbirth",class extends HTMLElement{constructor(){super()}connectedCallback(){const t=c.htmlToElement(C);this.appendChild(t),this.querySelector("#btnRestartGame").addEventListener("click",()=>{document.querySelector("#game-container").classList.remove("hidden"),document.getElementById("gameWinBirthDialog").close(),document.dispatchEvent(new CustomEvent("startgame"))})}show(t){document.querySelector("#game-container").classList.add("hidden"),document.getElementById("gameWinBirthDialog").showModal()}});const q="It looks like you are imprisoned in a magic world, if you wanna escape you have to eat all the pizza and avoid the hunting ghosts";function _(){return q}customElements.define("app-game",class extends HTMLElement{constructor(){super()}connectedCallback(){this.append(...c.htmlToHTMLCollection(y)),this.querySelector("#claim-content").innerText=_(),setTimeout(()=>this.showClaim(),1e3),this.querySelector("#btnStartGame").addEventListener("click",()=>document.dispatchEvent(new CustomEvent("startgame"))),this.querySelector("#btnClaimStartGame").addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("startgame")),document.querySelector("#claimContainer").classList.add("hidden"),document.querySelector("#game-container").classList.remove("hidden")}),document.addEventListener("gameover",t=>{this.querySelector("app-gameover").show(t.detail),document.getElementById("pacman_death").play()}),document.addEventListener("gamewin",t=>{this.querySelector("app-gamewin").show(t.detail),setTimeout(()=>document.getElementById("pacman_win").play(),200)})}showClaim(){const t=this.querySelector("#claimContainer"),e=t.animate([{opacity:0},{opacity:1}]);e.onfinish=s=>t.classList.remove("hidden")}});const M=document.createElement("app-game");document.querySelector("body").appendChild(M);
